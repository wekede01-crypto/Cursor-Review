name: 每日亚马逊爬虫

# 设定触发条件
on:
  schedule:
    # 每天国际标准时间 00:00 运行 (相当于北京时间早上 8:00)
    - cron: '0 0 * * *'
  # 允许你手动点击按钮触发 (方便测试)
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest # 使用最新的 Ubuntu 系统

    steps:
    # 1. 把代码拉取下来
    - name: Checkout code
      uses: actions/checkout@v3

    # 2. 安装 Python 环境
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    # 3. 安装依赖库 (requests, pandas 等)
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests beautifulsoup4 pandas matplotlib

    # 4. 运行爬虫脚本 (抓数据)
    - name: Run Spider
      run: python spider.py

    # 5. 运行报表脚本 (画图 & 生成网页)
    - name: Run Web Report
      run: python web_report.py

    # 6. 提交并推送更改 (把新生成的 chart.png 和 csv 存回仓库)
    - name: Commit and push changes
      run: |
        git config --global user.name "GitHub Action Bot"
        git config --global user.email "actions@github.com"
        git add .
        # 如果有变化才提交，没变化就不报错
        git commit -m "Auto-update: Daily Price Report" || exit 0
        git push